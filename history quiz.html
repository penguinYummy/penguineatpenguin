<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì‚¬ ì—°ë„ í€´ì¦ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark mode background */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 800px;
            padding: 2rem;
            background-color: #2d3748; /* Card background */
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn {
            background-color: #4a5568;
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
        }
        .btn:hover {
            background-color: #636b77;
        }
        .btn-primary {
            background-color: #4299e1;
        }
        .btn-primary:hover {
            background-color: #3182ce;
        }
        /* ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ */
        .btn-menu-return {
            background-color: #6B7280; /* Gray-500 */
            margin-top: 1rem;
        }
        .btn-menu-return:hover {
            background-color: #4B5563; /* Gray-700 */
        }
        /* ê¸°ì¡´ quiz-view ë‚´ ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ì„ ìˆ¨ê¸°ê¸° ìœ„í•´ ìˆ˜ì • */
        #quiz-view .top-menu-btn {
            background-color: #F87171; /* Red-400 */
        }


        .input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .input-box {
            background-color: #4a5568;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            padding: 0.5rem;
            border-radius: 0.5rem;
            width: 100%;
            -moz-appearance: textfield; /* Firefox */
        }
        /* Remove number input arrows for Webkit browsers (Chrome, Safari, etc.) */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        #result-message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: bold;
        }
        .correct-bg {
            background-color: #10B981; /* green-500 */
        }
        .wrong-bg {
            background-color: #EF4444; /* red-500 */
        }
        /* Adjusted wrong-answer item background color */
        .wrong-item-bg {
            background-color: #7f1d1d; /* red-700 (softer) */
        }
    </style>
</head>
<body>

<div id="app" class="container">
    <div id="main-menu" class="text-center">
        <h1 class="text-4xl font-bold mb-8">í•œêµ­ì‚¬ ì—°ë„ í€´ì¦ˆ</h1>
        <div class="space-y-4">
            <button class="btn w-full text-lg" onclick="showScreen('timeline')">ì—°í‘œ ë³´ê¸°</button>
            <button class="btn w-full text-lg" onclick="showQuizYearSelection(false)">ë¬¸ì œ ì‹œì‘</button>
            <button class="btn w-full text-lg" onclick="showQuizWrongAnswers()">í‹€ë¦° ë¬¸ì œ í’€ê¸°</button>
            <button class="btn w-full text-lg" onclick="showWrongAnswers()">í‹€ë¦° ì—°ë„ ë³´ê¸°</button>
        </div>
    </div>

    <div id="timeline-view" class="hidden">
        <h2 class="text-2xl font-bold mb-4">ì „ì²´ ì—°í‘œ</h2>
        <div class="mb-4">
            <input type="text" id="timeline-search" placeholder="ì—°ë„ë‚˜ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." class="input-box bg-gray-600 rounded-md">
        </div>
        <div id="timeline-list" class="space-y-2 max-h-96 overflow-y-auto pr-4"></div>
        <button class="btn mt-4" onclick="showScreen('menu')">ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="year-selection-view" class="hidden text-center">
        <h2 class="text-2xl font-bold mb-4">í€´ì¦ˆ ì—°ë„ ì„ íƒ</h2>
        <p class="mb-4">ì‹œì‘ ì—°ë„ì™€ ë ì—°ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        <div class="flex justify-around mb-8">
            <div class="text-center">
                <label for="startYear" class="block mb-2 text-lg">ì‹œì‘ ì—°ë„</label>
                <select id="startYear" class="input-box bg-gray-600 rounded-md">
                    <option value="1900">1900ë…„ëŒ€</option>
                    <option value="1910">1910ë…„ëŒ€</option>
                    <option value="1920">1920ë…„ëŒ€</option>
                    <option value="1930">1930ë…„ëŒ€</option>
                    <option value="1940">1940ë…„ëŒ€</option>
                </select>
            </div>
            <div class="text-center">
                <label for="endYear" class="block mb-2 text-lg">ë ì—°ë„</label>
                <select id="endYear" class="input-box bg-gray-600 rounded-md">
                    <option value="1910">1910ë…„ëŒ€</option>
                    <option value="1920">1920ë…„ëŒ€</option>
                    <option value="1930">1930ë…„ëŒ€</option>
                    <option value="1940">1940ë…„ëŒ€</option>
                    <option value="1950">1950ë…„ëŒ€</option>
                </select>
            </div>
        </div>
        <button class="btn btn-primary w-full text-lg" onclick="startQuizFromSelection()">í€´ì¦ˆ ì‹œì‘</button>
    </div>

    <div id="quiz-view" class="hidden text-center">
        <div class="flex justify-between items-start w-full mb-8">
            <div id="quiz-header">
                <p class="text-xl">ë¬¸ì œ <span id="current-question"></span> / <span id="total-questions"></span></p>
                <p class="text-xl">ë§ì¶˜ ë¬¸ì œ: <span id="correct-count"></span></p>
            </div>
            <button class="btn text-sm px-4 py-2 top-menu-btn" onclick="showScreen('menu')">ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button> 
        </div>
        <h3 id="event-name" class="text-3xl font-bold mb-8"></h3>
        <div class="input-group mb-8 w-full max-w-sm mx-auto">
            <input type="number" id="year-input" placeholder="ì—°ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1919)" class="input-box text-center">
            <input type="number" id="month-input" placeholder="ì›”ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ ì‚¬í•­)" class="input-box text-center">
        </div>
        <div id="quiz-actions" class="flex justify-center space-x-4">
            </div>
        <div id="result-message" class="hidden"></div>
        
        <button class="btn btn-menu-return w-full text-lg" onclick="showScreen('menu')">ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="final-score-view" class="hidden text-center">
        <h2 class="text-3xl font-bold mb-4">í€´ì¦ˆ ì¢…ë£Œ</h2>
        <p id="final-score-text" class="text-2xl mb-8"></p>
        <button class="btn text-lg" onclick="showScreen('menu')">ë©”ì¸ ë©”ë‰´ë¡œ</button>
    </div>

    <div id="wrong-answers-view" class="hidden">
        <h2 class="text-2xl font-bold mb-4">í‹€ë¦° ì—°ë„ ëª©ë¡</h2>
        <div id="wrong-list" class="space-y-2 max-h-96 overflow-y-auto pr-4"></div>
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-x-4 sm:space-y-0 mt-4">
            <button class="btn flex-1" onclick="showScreen('menu')">ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
            <button class="btn btn-primary bg-red-500 hover:bg-red-600 flex-1" onclick="resetWrongCounts()">í‹€ë¦° ì—°ë„ ì´ˆê¸°í™”</button>
        </div>
    </div>

</div>

<div id="message-box" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
    <div class="bg-gray-700 p-6 rounded-lg shadow-xl text-center">
        <p id="message-text" class="text-xl mb-4"></p>
        <button class="btn" onclick="hideMessage()">í™•ì¸</button>
    </div>
</div>


<script>
    // ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ
    // ì‚¬ìš©ìê°€ ë„£ì„ ì˜ˆì •ì´ë¯€ë¡œ ë¹ˆ ë°°ì—´ë¡œ ë‚¨ê²¨ë‘¡ë‹ˆë‹¤.
    const events = [
        { name: "íšŒì‚¬ë ¹", year: 1910, month: 0 },
        { name: "ë²”ì£„ ì¦‰ê²°ë ˆ", year: 1910, month: 0 },
        { name: "í† ì§€ ì¡°ì‚¬ ì‚¬ì—…", year: 1910, month: 0 },
        { name: "ì œ1ì°¨ ì¡°ì„ êµìœ¡ë ¹", year: 1911, month: 0 },
        { name: "ì‚¼ë¦¼ë ¹", year: 1911, month: 0 },
        { name: "ì¡°ì„  íƒœí˜•ë ¹", year: 1912, month: 0 },
        { name: "í† ì§€ ì¡°ì‚¬ë ¹", year: 1912, month: 0 },
        { name: "ì œ1ì°¨ ì„¸ê³„ëŒ€ì „", year: 1914, month: 0 },
        { name: "ê²½ì›ì„ , í˜¸ë‚¨ì„  ì™„ê³µ", year: 1914, month: 0 },
        { name: "ì„ì•¼ ì¡°ì‚¬ ì‚¬ì—…", year: 1917, month: 0 },
        { name: "ê³ ì¢… ì‚¬ë§", year: 1919, month: 1 },
        { name: "2Â·8 ë…ë¦½ ì„ ì–¸", year: 1919, month: 2 },
        { name: "3Â·1 ìš´ë™", year: 1919, month: 3 },
        { name: "ëŒ€í•œ êµ­ë¯¼ ì˜íšŒ", year: 1919, month: 3 },
        { name: "ëŒ€í•œë¯¼êµ­ ì„ì‹œ í—Œì¥", year: 1919, month: 4 },
        { name: "í•œì„± ì •ë¶€ ì„ í¬", year: 1919, month: 4 },
        { name: "ëŒ€í•œë¯¼êµ­ ì„ì‹œ ì •ë¶€(í†µí•© ì „)", year: 1919, month: 4 },
        { name: "ëŒ€í•œë¯¼êµ­ ì„ì‹œ ì •ë¶€(í†µí•© í›„)", year: 1919, month: 9 },
        { name: "ëŒ€í•œë¯¼êµ­ ì„ì‹œ í—Œë²•", year: 1919, month: 9 },
        { name: "ì˜ì—´ë‹¨ ì¡°ì§", year: 1919, month: 0 },
        { name: "ë´‰ì˜¤ë™ ì „íˆ¬", year: 1920, month: 6 },
        { name: "ì²­ì‚°ë¦¬ ëŒ€ì²©", year: 1920, month: 10 },
        { name: "ê°„ë„ ì°¸ë³€", year: 1920, month: 10 },
        { name: "íšŒì‚¬ë ¹ í˜ì§€", year: 1920, month: 0 },
        { name: "ì‚°ë¯¸ ì¦ì‹ ê³„íš", year: 1920, month: 0 },
        { name: "ë¬¼ì‚° ì¥ë ¤ ìš´ë™", year: 1920, month: 0 },
        { name: "ëŒ€í•œë¯¼êµ­ ì„ì‹œ ì •ë¶€ ì¹¨ì²´", year: 1921, month: 0 },
        { name: "ììœ ì‹œ ì°¸ë³€", year: 1921, month: 0 },
        { name: "ì¡°ì„ ì–´ ì—°êµ¬íšŒ", year: 1921, month: 0 },
        { name: "êµ­ë¯¼ ëŒ€í‘œ íšŒì˜", year: 1923, month: 0 },
        { name: "ì¡°ì„  í˜ëª… ì„ ì–¸", year: 1923, month: 0 },
        { name: "ì¡°ì„  ë¯¼ë¦½ ëŒ€í•™ ê¸°ì„±íšŒ", year: 1923, month: 0 },
        { name: "ì•”íƒœë„ ì†Œì‘ìŸì˜", year: 1923, month: 0 },
        { name: "ê´€ì„¸ íì§€", year: 1923, month: 0 },
        { name: "í˜•í‰ ìš´ë™", year: 1923, month: 0 },
        { name: "ê²½ì„± ì œêµ­ ëŒ€í•™", year: 1924, month: 0 },
        { name: "ì¡°ì„  ë…¸ë† ì´ë™ë§¹", year: 1924, month: 0 },
        { name: "ì¡°ì„  ì²­ë…„ ì´ë™ë§¹", year: 1924, month: 0 },
        { name: "ì œ1ì°¨ êµ­ê³µí•©ì‘", year: 1924, month: 0 },
        { name: "ì¡°ì„  ê³µì‚°ë‹¹ ì¡°ì§", year: 1925, month: 0 },
        { name: "ì¹˜ì•ˆìœ ì§€ë²•(ê°œì • ì „)", year: 1925, month: 0 },
        { name: "ë°•ì€ì‹ì„ ì„ì‹œ ëŒ€í†µë ¹ìœ¼ë¡œ ì¶”ëŒ€", year: 1925, month: 0 },
        { name: "ì¡°ì„  í•™ìƒ ê³¼í•™ ì—°êµ¬íšŒ ì„¤ë¦½", year: 1925, month: 0 },
        { name: "ë¯¸ì“°ì•¼ í˜‘ì •", year: 1925, month: 0 },
        { name: "6Â·10 ë§Œì„¸ ìš´ë™", year: 1926, month: 6 },
        { name: "ìˆœì¢… ì„œê±°", year: 1926, month: 0 },
        { name: "ì •ìš°íšŒ ì„ ì–¸", year: 1926, month: 0 },
        { name: "ì‹ ê°„íšŒ ì°½ë¦½", year: 1927, month: 0 },
        { name: "ì¡°ì„  ë†ë¯¼ ì´ë™ë§¹, ì¡°ì„  ë…¸ë™ ì´ë™ë§¹", year: 1927, month: 0 },
        { name: "ì¡°ì„  ê³µì‚°ë‹¹ í•´ì²´", year: 1928, month: 0 },
        { name: "ì¹˜ì•ˆ ìœ ì§€ë²•(ê°œì • í›„)", year: 1928, month: 0 },
        { name: "í•¨ê²½ì„ ", year: 1928, month: 0 },
        { name: "ì›ì‚° ì´íŒŒì—…", year: 1929, month: 0 },
        { name: "ëŒ€ê³µí™©", year: 1929, month: 0 },
        { name: "3ë¶€ í†µí•©", year: 1929, month: 0 },
        { name: "ê´‘ì£¼ í•™ìƒ í•­ì¼ ìš´ë™", year: 1929, month: 0 },
        { name: "ë¬¸ì ë³´ê¸‰ ìš´ë™", year: 1929, month: 0 },
        { name: "ë§Œì£¼ ì‚¬ë³€", year: 1931, month: 0 },
        { name: "í•œì¸ ì• êµ­ë‹¨", year: 1931, month: 0 },
        { name: "ì‹ ê°„íšŒ í•´ì†Œ", year: 1931, month: 0 },
        { name: "ì¡°ì„ ì–´ í•™íšŒ", year: 1931, month: 0 },
        { name: "ë¸Œë‚˜ë¡œë“œ ìš´ë™", year: 1931, month: 0 },
        { name: "ì´ë´‰ì°½, ìœ¤ë´‰ê¸¸ í­íƒ„ íˆ¬í•˜", year: 1932, month: 0 },
        { name: "ë†ì´Œ ì§„í¥ ìš´ë™", year: 1932, month: 0 },
        { name: "ì¡°ì„  ë†ì§€ë ¹", year: 1934, month: 0 },
        { name: "ì¡°ì„  ë¯¼ì¡± í˜ëª…ë‹¹", year: 1935, month: 0 },
        { name: "í•œêµ­ êµ­ë¯¼ë‹¹", year: 1935, month: 0 },
        { name: "ì¡°ì„  ì‚¬ìƒë²” ë³´í˜¸ ê´€ì°°ë ¹", year: 1936, month: 0 },
        { name: "ì¤‘ì¼ì „ìŸ", year: 1937, month: 0 },
        { name: "ë³´ì²œë³´ ì „íˆ¬", year: 1937, month: 0 },
        { name: "í•œêµ­ ê´‘ë³µ ìš´ë™ ë‹¨ì²´ ì—°í•©íšŒ", year: 1937, month: 0 },
        { name: "ì¡°ì„  êµìœ¡ë ¹ ê°œì •", year: 1938, month: 0 },
        { name: "êµ­ë¯¼ ì´ë™ì› ì¡°ì„  ì—°ë§¹(ì• êµ­ë°˜)", year: 1938, month: 0 },
        { name: "êµ­ê°€ ì´ë™ì›ë²•", year: 1938, month: 0 },
        { name: "ìœ¡êµ° íŠ¹ë³„ ì§€ì›ë³‘ì œ", year: 1938, month: 0 },
        { name: "êµ­ë¯¼ ì§•ìš©ë ¹", year: 1939, month: 0 },
        { name: "ì œ2ì°¨ ì„¸ê³„ ëŒ€ì „", year: 1939, month: 0 },
        { name: "ì¡°ì„ ì¼ë³´, ë™ì•„ì¼ë³´ íê°„", year: 1940, month: 0 },
        { name: "í•œêµ­ ë…ë¦½ë‹¹ (ì¶©ì¹­)", year: 1940, month: 0 },
        { name: "í•œêµ­ ê´‘ë³µêµ° ì°½ì„¤", year: 1940, month: 0 },
        { name: "íƒœí‰ì–‘ ì „ìŸ", year: 1941, month: 0 },
        { name: "ì´ˆë“±í•™êµ -> êµ­ë¯¼í•™êµ", year: 1941, month: 0 },
        { name: "ì¡°ì„  ì‚¬ìƒë²” ì˜ˆë°© êµ¬ê¸ˆë ¹", year: 1941, month: 0 },
        { name: "ì¡°ì„  ì˜ìš©ëŒ€ í™”ë¶ì§€ëŒ€", year: 1941, month: 0 },
        { name: "ëŒ€í•œë¯¼êµ­ ì„ì‹œ ì •ë¶€(ì¶©ì¹­)ì˜ ê±´êµ­ ê°•ë ¹", year: 1941, month: 0 },
        { name: "ì¡°ì„ ì–´ í•™íšŒ ì‚¬ê±´", year: 1942, month: 0 },
        { name: "ì¡°ì„  ë…ë¦½ ë™ë§¹", year: 1942, month: 0 },
        { name: "ì¡°ì„  ë…ë¦½ ë™ë§¹ì˜ ê±´êµ­ ê°•ë ¹", year: 1942, month: 0 },
        { name: "í•™ë„ ì§€ì›ë³‘ì œ", year: 1943, month: 0 },
        { name: "ì¹´ì´ë¡œ íšŒë‹´", year: 1943, month: 0 },
        { name: "ì§•ë³‘ì œ", year: 1944, month: 0 },
        { name: "ì¡°ì„  ê±´êµ­ ë™ë§¹", year: 1944, month: 0 },
        { name: "ì¡°ì„  ê±´êµ­ ë™ë§¹ì˜ ê±´êµ­ ê°•ë ¹", year: 1944, month: 0 },
        { name: "ì–„íƒ€ íšŒë‹´", year: 1945, month: 2 },
        { name: "í¬ì¸ ë‹´ íšŒë‹´", year: 1945, month: 7 },
        { name: "ì†Œë ¨ì˜ ëŒ€ì¼ì „ ì°¸ì „", year: 1945, month: 8 },
        { name: "ëª¨ìŠ¤í¬ë°” 3êµ­ ì™¸ìƒ íšŒì˜", year: 1945, month: 12 },
        { name: "ê´‘ë³µ", year: 1945, month: 0 },
        { name: "ìœ ì—” ì„¤ë¦½", year: 1945, month: 0 },
        { name: "ì œ 1ì°¨ ë¯¸ì†Œ ê³µë™ ìœ„ì›íšŒ ê°œìµœ", year: 1946, month: 3 },
        { name: "ì œ 1ì°¨ ë¯¸ì†Œ ê³µë™ ìœ„ì›íšŒ ê²°ë ¬", year: 1946, month: 5 },
        { name: "ì´ìŠ¹ë§Œì˜ ì •ì ë°œì–¸", year: 1946, month: 6 },
        { name: "ì¢Œìš° í•©ì‘ ìš´ë™", year: 1946, month: 7 },
        { name: "ì¢Œìš° í•©ì‘ ìœ„ì›íšŒ ê²°ì„±", year: 1946, month: 7 },
        { name: "íŠ¸ë£¨ë¨¼ ë…íŠ¸ë¦° ë°œí‘œ", year: 1947, month: 3 },
        { name: "ì œ 2ì°¨ ë¯¸ì†Œ ê³µë™ ìœ„ì›íšŒ ê°œìµœ", year: 1947, month: 5 },
        { name: "í•œë°˜ë„ ë¬¸ì œê°€ ìœ ì—”ìœ¼ë¡œ ì´ê´€", year: 1947, month: 9 },
        { name: "ì œ 2ì°¨ ë¯¸ì†Œ ê³µë™ ìœ„ì›íšŒ ê²°ë ¬", year: 1947, month: 10 },
        { name: "í•œë°˜ë„ ì´ì„ ê±° ì‹¤ì‹œ ê²°ì •", year: 1947, month: 11 },
        { name: "ë‚¨í•œë§Œì˜ ë‹¨ë… ì„ ê±° ì‹¤ì‹œ ê²°ì •", year: 1948, month: 2 },
        { name: "ê¹€êµ¬ì˜ ë‚¨ë¶ í˜‘ìƒ", year: 1948, month: 4 },
        { name: "ì„ ê±°ë¥¼ í†µí•œ í†µì¼ ì •ë¶€ ìˆ˜ë¦½ì„ ë‹´ì€ ê³µë™ ì„±ëª…ì„œ", year: 1948, month: 4 }
    ];


    let state = {
        screen: 'menu',
        questions: [],
        currentQuestionIndex: 0,
        score: 0,
        wrongCounts: {},
        wrongOnly: false
    };

    // DOM ìš”ì†Œ ìºì‹±
    const screens = {
        menu: document.getElementById('main-menu'),
        timeline: document.getElementById('timeline-view'),
        yearSelection: document.getElementById('year-selection-view'),
        quiz: document.getElementById('quiz-view'),
        finalScore: document.getElementById('final-score-view'),
        wrongAnswers: document.getElementById('wrong-answers-view')
    };

    function showScreen(screenName) {
        for (const screen in screens) {
            screens[screen].classList.add('hidden');
        }
        screens[screenName].classList.remove('hidden');

        if (screenName === 'timeline') {
            document.getElementById('timeline-search').value = '';
            renderTimeline();
        } else if (screenName === 'wrongAnswers') {
            renderWrongAnswers();
        } else if (screenName === 'quiz') {
            document.getElementById('year-input').focus();
        }
    }

    // í‹€ë¦° ì—°ë„ ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ ì¶”ê°€
    function showWrongAnswers() {
        showScreen('wrongAnswers');
    }

    // ë©”ì‹œì§€ ì°½ì„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
    function showMessage(message) {
        document.getElementById('message-text').textContent = message;
        document.getElementById('message-box').classList.remove('hidden');
    }

    // ë©”ì‹œì§€ ì°½ì„ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜
    function hideMessage() {
        document.getElementById('message-box').classList.add('hidden');
    }

    // ê²€ìƒ‰ ê¸°ëŠ¥ ë¡œì§ì´ ì¶”ê°€ë˜ê³ , ì´ˆê¸°í™” ì˜¤ë¥˜ê°€ ìˆ˜ì •ëœ renderTimeline í•¨ìˆ˜
    function renderTimeline(searchTerm = '') {
        const timelineList = document.getElementById('timeline-list');
        // events ë°°ì—´ì´ ë¹„ì–´ìˆì„ ê²½ìš° ì²˜ë¦¬
        if (events.length === 0) {
            timelineList.innerHTML = `<p class="text-center text-red-400">ğŸš¨ ì´ë²¤íŠ¸ ëª©ë¡(events ë°°ì—´)ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
            return;
        }

        const normalizedSearchTerm = searchTerm.toLowerCase().trim();
        
        // ê²€ìƒ‰ì–´ì— ë”°ë¼ ì´ë²¤íŠ¸ í•„í„°ë§
        let eventsToRender = events; 

        if (normalizedSearchTerm) {
            eventsToRender = events.filter(event => {
                const eventName = event.name.toLowerCase();
                const eventYear = String(event.year);
                const eventDate = event.month !== 0 ? `${event.year}.${event.month}` : `${event.year}`;
                
                return eventName.includes(normalizedSearchTerm) || 
                       eventYear.includes(normalizedSearchTerm) ||
                       eventDate.includes(normalizedSearchTerm);
            });
        }
        
        if (eventsToRender.length === 0) {
            timelineList.innerHTML = `<p class="text-center text-gray-400">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }
        
        timelineList.innerHTML = eventsToRender.map((event, index) => {
            const date = event.month !== 0 ? `${event.year}.${event.month}` : `${event.year}`;
            return `<div class="p-2 bg-gray-700 rounded-lg">
                        <p class="font-bold">${event.name}</p>
                        <p class="text-sm text-gray-400">${date}</p>
                    </div>`;
        }).join('');
    }

    function renderWrongAnswers() {
        loadWrongCounts();
        const wrongList = document.getElementById('wrong-list');
        
        let wrongEvents = events.filter(event => state.wrongCounts[event.name] > 0);

        if (wrongEvents.length === 0) {
            wrongList.innerHTML = `<p class="text-center text-gray-400">í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</p>`;
            return;
        }

        // Add wrongCount to each event object for sorting and display
        wrongEvents = wrongEvents.map(event => ({
            ...event,
            wrongCount: state.wrongCounts[event.name]
        }));
        
        // Now sort correctly based on the new wrongCount property
        wrongEvents.sort((a, b) => b.wrongCount - a.wrongCount); 

        // í‹€ë¦° ë¬¸ì œ ëª©ë¡ì— `wrong-item-bg` í´ë˜ìŠ¤ ì ìš©
        wrongList.innerHTML = wrongEvents.map(event => {
            const date = event.month !== 0 ? `${event.year}.${event.month}` : `${event.year}`;
            return `<div class="p-2 wrong-item-bg rounded-lg">
                        <p class="font-bold">${event.name}</p>
                        <p class="text-sm text-gray-300">ì •ë‹µ: ${date} - í‹€ë¦° íšŸìˆ˜: ${event.wrongCount}</p>
                    </div>`;
        }).join('');
    }

    // í‹€ë¦° íšŸìˆ˜ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
    function resetWrongCounts() {
        state.wrongCounts = {};
        saveWrongCounts();
        renderWrongAnswers();
        showMessage('í‹€ë¦° ì—°ë„ ê¸°ë¡ì´ ëª¨ë‘ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function showQuizYearSelection(wrongOnly) {
        state.wrongOnly = wrongOnly;
        showScreen('yearSelection');
    }

    function showQuizWrongAnswers() {
        loadWrongCounts();
        const wrongEvents = events.filter(event => state.wrongCounts[event.name] > 0);
        if (wrongEvents.length === 0) {
            showMessage('í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!');
            return;
        }
        state.wrongOnly = true;
        startQuiz(wrongEvents);
    }

    function startQuizFromSelection() {
        const startYear = parseInt(document.getElementById('startYear').value);
        const endYear = parseInt(document.getElementById('endYear').value);

        if (endYear < startYear) {
            showMessage('ë ì—°ë„ëŠ” ì‹œì‘ ì—°ë„ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
            return;
        }
        
        let filteredEvents = events.filter(event => event.year >= startYear && event.year < endYear);
        if (state.wrongOnly) {
             filteredEvents = filteredEvents.filter(event => state.wrongCounts[event.name] > 0);
        }
        
        if (filteredEvents.length === 0) {
            showMessage('í•´ë‹¹ ì—°ë„ì— ë§ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        startQuiz(filteredEvents);
    }

    function startQuiz(filteredEvents) {
        state.questions = [...filteredEvents];
        shuffleArray(state.questions);
        state.currentQuestionIndex = 0;
        state.score = 0;
        
        document.getElementById('total-questions').textContent = state.questions.length;
        document.getElementById('correct-count').textContent = state.score;

        showScreen('quiz');
        renderQuestion();
    }

    function renderQuestion() {
        if (state.currentQuestionIndex >= state.questions.length) {
            showFinalScore();
            return;
        }

        const currentEvent = state.questions[state.currentQuestionIndex];
        document.getElementById('event-name').textContent = currentEvent.name;
        document.getElementById('current-question').textContent = state.currentQuestionIndex + 1;
        document.getElementById('year-input').value = '';
        document.getElementById('month-input').value = '';
        
        // ì›”ì´ ì—†ëŠ” ë¬¸ì œì¸ ê²½ìš° ì›” ì…ë ¥ë€ ìˆ¨ê¸°ê¸°
        if (currentEvent.month === 0) {
            document.getElementById('month-input').style.display = 'none';
        } else {
            document.getElementById('month-input').style.display = 'block';
        }

        // ê²°ê³¼ ë©”ì‹œì§€ ì´ˆê¸°í™”
        const resultMessage = document.getElementById('result-message');
        resultMessage.classList.add('hidden');
        resultMessage.classList.remove('correct-bg', 'wrong-bg');

        // ê¸°ì¡´ì˜ 'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ì´ ìˆë‹¤ë©´ ì œê±°
        const quizActions = document.getElementById('quiz-actions');
        quizActions.innerHTML = ''; 
        
        // ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°ˆ ë•Œ ë¬´ì¡°ê±´ ë…„ë„ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ë¥¼ ë§ì¶¥ë‹ˆë‹¤.
        document.getElementById('year-input').focus();
    }

    function checkAnswer() {
        const currentEvent = state.questions[state.currentQuestionIndex];
        const yearInput = parseInt(document.getElementById('year-input').value);
        const monthInput = parseInt(document.getElementById('month-input').value) || 0;
        const resultMessage = document.getElementById('result-message');
        const isAnswered = document.getElementById('next-question-btn');

        if (isAnswered) return;
        if (!currentEvent) return; // ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ì²˜ë¦¬ ì¤‘ë‹¨

        const isCorrect = yearInput === currentEvent.year && (currentEvent.month === 0 || monthInput === currentEvent.month);

        if (isCorrect) {
            state.score++;
            document.getElementById('correct-count').textContent = state.score;
            resultMessage.textContent = 'ì •ë‹µì…ë‹ˆë‹¤.';
            resultMessage.classList.add('correct-bg');
        } else {
            resultMessage.innerHTML = `ì˜¤ë‹µì…ë‹ˆë‹¤.<br>ì •ë‹µ: ${currentEvent.year}${currentEvent.month !== 0 ? `ë…„ ${currentEvent.month}ì›”` : 'ë…„'}`;
            resultMessage.classList.add('wrong-bg');
            state.wrongCounts[currentEvent.name] = (state.wrongCounts[currentEvent.name] || 0) + 1;
            saveWrongCounts();
        }

        resultMessage.classList.remove('hidden');

        // 'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ ìƒì„±
        const quizActions = document.getElementById('quiz-actions');
        const nextBtn = document.createElement('button');
        nextBtn.id = 'next-question-btn';
        nextBtn.className = 'btn btn-primary text-lg';
        nextBtn.textContent = 'ë‹¤ìŒ ë¬¸ì œ(space)';
        nextBtn.onclick = () => {
            state.currentQuestionIndex++;
            renderQuestion();
        };
        quizActions.appendChild(nextBtn);
    }

    function showFinalScore() {
        const finalScoreText = document.getElementById('final-score-text');
        const totalQuestions = state.questions.length;
        finalScoreText.textContent = `${totalQuestions} ë¬¸ì œ ì¤‘ ${state.score} ë¬¸ì œë¥¼ ë§ì·„ìŠµë‹ˆë‹¤.`;
        showScreen('finalScore');
    }

    function saveWrongCounts() {
        localStorage.setItem('wrongCounts', JSON.stringify(state.wrongCounts));
    }

    function loadWrongCounts() {
        const storedCounts = localStorage.getItem('wrongCounts');
        if (storedCounts) {
            state.wrongCounts = JSON.parse(storedCounts);
        } else {
            state.wrongCounts = {};
        }
    }

    // ì—°ë„ ì…ë ¥ í•„ë“œì— í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ì—”í„° í‚¤ ëˆ„ë¥´ë©´ ì›” ì…ë ¥ë€ìœ¼ë¡œ ì´ë™)
    document.getElementById('year-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            const currentEvent = state.questions[state.currentQuestionIndex];
            if (currentEvent && currentEvent.month !== 0) { 
                event.preventDefault();
                document.getElementById('month-input').focus();
            } else {
                checkAnswer();
            }
        }
    });

    // ì›” ì…ë ¥ í•„ë“œì— í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ì—”í„° í‚¤ ëˆ„ë¥´ë©´ ë‹µì•ˆ í™•ì¸)
    document.getElementById('month-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            checkAnswer();
        }
    });
    
    // ì „ì²´ ë¬¸ì„œì— í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ìŠ¤í˜ì´ìŠ¤ë°” ëˆ„ë¥´ë©´ ë‹¤ìŒ ë¬¸ì œë¡œ)
    document.addEventListener('keydown', function(event) {
        const nextBtn = document.getElementById('next-question-btn');
        if (event.key === ' ' && nextBtn) {
            event.preventDefault();
            nextBtn.click();
        }
    });

    // Add event listener for the search input
    document.getElementById('timeline-search').addEventListener('input', (e) => {
        renderTimeline(e.target.value);
    });
    
    // ì´ˆê¸°í™” ë° ì‹œì‘
    loadWrongCounts();
    showScreen('menu');

</script>
</body>
</html>
